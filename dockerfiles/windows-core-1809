######## INSTALL ########

# Set the base image
FROM mcr.microsoft.com/windows/servercore:1809

# Set alternative shell
SHELL ["powershell"]

# Set environment variables
ENV POWERSHELL_TELEMETRY_OPTOUT 1
ENV HOME "c:\steamcmd"

# Create SteamCMD directory
RUN New-Item -ItemType Directory $HOME

# Set SteamCMD working directory
WORKDIR $HOME

# Download and unpack SteamCMD archive
RUN Invoke-WebRequest "http://media.steampowered.com/installer/steamcmd.zip" -O "$HOME\steamcmd.zip"; \
    Expand-Archive "$HOME\steamcmd.zip" -DestinationPath "$HOME"; \
    Remove-Item "$HOME\steamcmd.zip"

# Create executable alias
RUN New-Item -Path "c:\windows\system32\steamcmd.exe" -ItemType SymbolicLink -Value "$HOME\steamcmd.exe"

# Update SteamCMD
RUN steamcmd.exe +quit; exit 0

# Set default command
ENTRYPOINT steamcmd.exe
CMD +help +quit
